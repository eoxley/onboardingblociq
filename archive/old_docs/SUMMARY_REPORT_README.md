# 📄 Summary Report Generator

## Overview

The BlocIQ Onboarding Generator now automatically creates formatted summary reports in **PDF** or **Word** format after each onboarding run.

## Features

✅ Auto-generates professional summary reports
✅ Supports PDF (default) and Word (.docx) formats
✅ Includes all onboarding statistics and enrichment data
✅ Formatted with tables, colors, and sections
✅ Adds `report_file` reference to `summary.json`
✅ Works offline (no external services)

---

## Output Formats

### PDF Report (Default)

**File:** `output/summary_report.pdf`

- Professional layout with A4 page size
- Color-coded tables for different sections
- BlocIQ branding (blue headers)
- Includes:
  - Building name and timestamp
  - Onboarding statistics table
  - Document categories breakdown
  - Post-processing enrichment stats
  - Building intelligence breakdown

### Word Report

**File:** `output/summary_report.docx`

- Microsoft Word compatible (.docx)
- Styled with built-in Word styles
- Formatted tables with grid layout
- Easy to edit and customize
- Same content as PDF version

---

## Usage

### Default (PDF)

```bash
# Generates PDF report automatically
python BlocIQ_Onboarder/onboarder.py "/path/to/building/"
```

**Output:**
```
✅ Summary: output/summary.json
✅ Summary PDF created: output/summary_report.pdf
```

### Force Word Output

```bash
# Set environment variable to generate Word document
OUTPUT_FORMAT=word python BlocIQ_Onboarder/onboarder.py "/path/to/building/"
```

**Or on Windows:**
```cmd
set OUTPUT_FORMAT=word
python BlocIQ_Onboarder/onboarder.py "C:\path\to\building\"
```

**Output:**
```
✅ Summary: output/summary.json
✅ Summary Word doc created: output/summary_report.docx
```

### Force Specific Format

```bash
# PDF
OUTPUT_FORMAT=pdf python BlocIQ_Onboarder/onboarder.py "/path/to/building/"

# Word/DOCX
OUTPUT_FORMAT=docx python BlocIQ_Onboarder/onboarder.py "/path/to/building/"
```

---

## Installation

### Install Dependencies

```bash
# Install all requirements including report generation
pip install -r BlocIQ_Onboarder/requirements.txt
```

**Or install manually:**

```bash
# For PDF support
pip install reportlab>=4.0.0

# For Word support (already included)
pip install python-docx>=1.0.0
```

---

## Report Contents

### 1. Header

```
🏢 BlocIQ Building Onboarding Summary

Building: Connaught Square
Generated: 2025-10-05T14:30:00
```

### 2. Onboarding Statistics

| Metric | Count |
|--------|-------|
| Files Parsed | 150 |
| Buildings | 1 |
| Units | 15 |
| Leaseholders | 12 |
| Documents | 150 |

### 3. Document Categories

| Category | Count |
|----------|-------|
| Compliance | 35 |
| Finance | 82 |
| Major Works | 12 |
| Lease | 8 |
| Contracts | 13 |

### 4. Post-Processing Enrichment

| Enhancement | Count |
|-------------|-------|
| Addresses Extracted | 1 |
| Major Works Tagged | 6 |
| Budget Placeholders | 12 |
| Building Knowledge Entries | 5 |

### 5. Building Intelligence

**Total Entries:** 5

| Category | Entries |
|----------|---------|
| 🔑 Access | 2 |
| ⚡ Utilities | 2 |
| 🧾 General | 1 |

### 6. Footer

```
Generated by BlocIQ Onboarding Generator
```

---

## Example Output

### Console Output

```
🏢 BlocIQ Onboarder
📁 Client Folder: /path/to/building

📄 Parsing files...
  ✅ Parsed 150 files

🏷️  Classifying documents...
  compliance: 35 files
  finance: 82 files

🔗 Mapping to Supabase schema...
  ✅ Building: Connaught Square
  ✅ Units: 15
  ✅ Leaseholders: 12

🔍 Validating data...
  ✅ Validation report: output/validation_report.json

🧠 Running post-processing enrichment...
  📊 Enrichment Summary:
     ✅ Addresses extracted: 1
     ✅ Major works tagged: 6
     🧠 Building knowledge entries: 5

  ✅ SQL migration: output/migration.sql

============================================================
✅ ONBOARDING COMPLETE
============================================================

  ✅ Summary: output/summary.json
  ✅ Summary PDF created: output/summary_report.pdf    ← NEW!

============================================================
```

### Updated `summary.json`

```json
{
  "timestamp": "2025-10-05T14:30:00",
  "building_name": "Connaught Square",
  "statistics": {
    "files_parsed": 150,
    "units": 15,
    "documents": 150
  },
  "post_processing_summary": {
    "addresses_extracted": 1,
    "major_works_tagged": 6,
    "building_intelligence_entries": 5
  },
  "report_file": "output/summary_report.pdf"    ← NEW!
}
```

---

## Customization

### Change Default Format

Edit `BlocIQ_Onboarder/report_generator.py` line ~18:

```python
# Change default from "pdf" to "word"
output_format = os.getenv("OUTPUT_FORMAT", "word").lower()
```

### Customize PDF Styles

Edit `_generate_pdf_report()` function:

```python
# Change title color
title_style = ParagraphStyle(
    'CustomTitle',
    parent=styles['Heading1'],
    fontSize=24,
    textColor=colors.HexColor('#1e40af'),  # Change this color
    spaceAfter=30,
    alignment=TA_CENTER
)

# Change table colors
('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#1e40af')),  # Header color
('BACKGROUND', (0, 1), (-1, -1), colors.beige),               # Row color
```

### Customize Word Styles

Edit `_generate_word_report()` function:

```python
# Use different table style
table.style = 'Light Grid Accent 1'  # Change to any Word table style
```

**Available Word table styles:**
- `Light Grid Accent 1` (default)
- `Medium Shading 1 Accent 1`
- `Colorful Grid Accent 1`
- `Dark List Accent 1`

---

## Programmatic Usage

### Generate Report Independently

```python
from BlocIQ_Onboarder.report_generator import export_summary_report

# Generate PDF
pdf_path = export_summary_report(
    summary_path="output/summary.json",
    output_dir="output",
    output_format="pdf"
)
print(f"PDF saved to: {pdf_path}")

# Generate Word
docx_path = export_summary_report(
    summary_path="output/summary.json",
    output_dir="output",
    output_format="word"
)
print(f"Word doc saved to: {docx_path}")
```

---

## Troubleshooting

### Missing Dependencies

**Symptom:**
```
⚠️ Could not generate report: No module named 'reportlab'
```

**Solution:**
```bash
pip install reportlab>=4.0.0
```

### Import Error

**Symptom:**
```
⚠️ Error generating report: cannot import name 'export_summary_report'
```

**Solution:**
- Ensure `report_generator.py` is in `BlocIQ_Onboarder/` directory
- Check Python path includes the onboarder directory

### Permission Error

**Symptom:**
```
⚠️ Error generating report: Permission denied
```

**Solution:**
- Ensure output directory is writable
- Close any open PDF/Word files before re-running

### Word Document Won't Open

**Symptom:**
Word document appears corrupted

**Solution:**
- Ensure `python-docx>=1.0.0` is installed
- Re-generate the report
- Try opening with LibreOffice or Google Docs

---

## PDF vs Word Comparison

| Feature | PDF | Word |
|---------|-----|------|
| **File Size** | ~50KB | ~20KB |
| **Editable** | ❌ No | ✅ Yes |
| **Formatting** | ✅ Perfect | ✅ Good |
| **Universal View** | ✅ Yes | ⚠️ Requires Word/LibreOffice |
| **Print Ready** | ✅ Yes | ✅ Yes |
| **Email Friendly** | ✅ Yes | ✅ Yes |
| **Professional** | ✅ Yes | ✅ Yes |

**Recommendation:**
- Use **PDF** for final reports, client delivery, archival
- Use **Word** for internal reports that need editing

---

## Use Cases

### 1. Client Onboarding Package

**Workflow:**
```bash
# Generate onboarding
python BlocIQ_Onboarder/onboarder.py "/path/to/client/building/"

# Email package includes:
# - summary_report.pdf (executive summary)
# - migration.sql (technical implementation)
# - validation_report.json (technical validation)
```

### 2. Internal Review

**Workflow:**
```bash
# Generate Word doc for team review
OUTPUT_FORMAT=word python BlocIQ_Onboarder/onboarder.py "/path/to/building/"

# Team can edit/annotate the Word doc
# Convert to PDF when finalized
```

### 3. Batch Processing

**Workflow:**
```python
import os
from pathlib import Path
from BlocIQ_Onboarder.onboarder import BlocIQOnboarder

buildings = [
    "/path/to/building1",
    "/path/to/building2",
    "/path/to/building3"
]

for building_path in buildings:
    onboarder = BlocIQOnboarder(building_path)
    onboarder.run()
    # PDF automatically generated for each building
```

---

## Advanced Configuration

### Environment Variables

```bash
# Set default format globally
export OUTPUT_FORMAT=pdf

# Or per-session
OUTPUT_FORMAT=word python BlocIQ_Onboarder/onboarder.py "/path/to/building/"
```

### Config File (Future)

Create `config.yml`:
```yaml
report:
  format: pdf  # or 'word'
  output_dir: output
  include_enrichment: true
  include_intelligence: true
```

---

## File Locations

After onboarding, you'll find:

```
output/
├── summary.json              # JSON summary with report_file reference
├── summary_report.pdf        # ← NEW! PDF summary (default)
├── summary_report.docx       # ← NEW! Word summary (if OUTPUT_FORMAT=word)
├── migration.sql             # SQL migration script
├── validation_report.json    # Validation report
├── audit_log.json           # Audit trail
└── document_log.csv         # Document inventory
```

---

## Summary

✅ **Automatic** - No extra commands needed
✅ **Professional** - Formatted, branded reports
✅ **Flexible** - PDF or Word format
✅ **Complete** - All onboarding stats included
✅ **Integrated** - Updates summary.json with file path
✅ **Offline** - No cloud dependencies
✅ **Fast** - Generates in <1 second

**Result:** Client-ready summary reports with every onboarding! 🎉
